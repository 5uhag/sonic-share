(function(){const n=document.createElement("link").relList;if(n&&n.supports&&n.supports("modulepreload"))return;for(const t of document.querySelectorAll('link[rel="modulepreload"]'))i(t);new MutationObserver(t=>{for(const r of t)if(r.type==="childList")for(const l of r.addedNodes)l.tagName==="LINK"&&l.rel==="modulepreload"&&i(l)}).observe(document,{childList:!0,subtree:!0});function s(t){const r={};return t.integrity&&(r.integrity=t.integrity),t.referrerPolicy&&(r.referrerPolicy=t.referrerPolicy),t.crossOrigin==="use-credentials"?r.credentials="include":t.crossOrigin==="anonymous"?r.credentials="omit":r.credentials="same-origin",r}function i(t){if(t.ep)return;t.ep=!0;const r=s(t);fetch(t.href,r)}})();"serviceWorker"in navigator&&window.addEventListener("load",()=>{navigator.serviceWorker.register("/sw.js").then(e=>{console.log("ServiceWorker registration successful with scope: ",e.scope),document.getElementById("connection-status").innerText="OFFLINE READY",document.querySelector(".dot").classList.replace("offline","online")}).catch(e=>{console.log("ServiceWorker registration failed: ",e),document.getElementById("connection-status").innerText="SW FAILED"})});const d=document.getElementById("tuning-knob"),o=d.getContext("2d"),u=document.getElementById("current-band"),h=document.getElementById("rx-log"),x=document.getElementById("btn-transmit"),A=document.getElementById("file-input"),m=document.getElementById("theme-toggle");let g=localStorage.getItem("theme")==="dark";g&&(document.body.setAttribute("data-theme","dark"),m.innerText="LIGHT");m.addEventListener("click",()=>{g=!g,g?(document.body.setAttribute("data-theme","dark"),m.innerText="LIGHT",localStorage.setItem("theme","dark")):(document.body.removeAttribute("data-theme"),m.innerText="DARK",localStorage.setItem("theme","light")),I(p)});let a=!0,p=0;function I(e){const n=d.width,s=d.height,i=n/2,t=s/2,r=45;o.clearRect(0,0,n,s);const l=getComputedStyle(document.body),T=l.getPropertyValue("--text-main").trim(),L=l.getPropertyValue("--panel-bg").trim();o.beginPath(),o.arc(i,t,r+5,0,2*Math.PI),o.fillStyle=T,o.fill(),o.beginPath(),o.arc(i,t,r,0,2*Math.PI),o.fillStyle=L,o.fill(),o.lineWidth=4,o.strokeStyle=T,o.stroke(),o.beginPath(),o.moveTo(i,t);const S=i+Math.cos(e)*(r-10),v=t+Math.sin(e)*(r-10);o.lineTo(S,v),o.lineWidth=6,o.stroke(),Math.abs(e)>Math.PI/2?a&&(a=!1,u.innerText="ULTRASONIC (18-21kHz)",u.style.background="#000"):a||(a=!0,u.innerText="AUDIBLE (1-5kHz)",u.style.background="var(--accent-1)")}let E=!1;d.addEventListener("mousedown",e=>{E=!0,b(e)});window.addEventListener("mouseup",()=>{E=!1});window.addEventListener("mousemove",e=>{E&&b(e)});function b(e){const n=d.getBoundingClientRect(),s=n.left+n.width/2,i=n.top+n.height/2;p=Math.atan2(e.clientY-i,e.clientX-s),I(p)}I(0);function f(e){const n=document.createElement("span"),s=new Date().toLocaleTimeString("en-US",{hour12:!1});n.innerText=`[${s}] ${e}`,h.appendChild(n),h.scrollTop=h.scrollHeight}x.addEventListener("click",()=>{const e=document.getElementById("payload-input").value;if(!e.trim())return alert("Enter a message to transmit.");f(`TX STARTED [${a?"AUDIBLE":"ULTRASONIC"}]: ${e.substring(0,15)}...`)});const c=document.getElementById("btn-listen");let y=!1;c.addEventListener("click",()=>{y=!y,y?(c.innerText="STOP LISTENING",c.style.background="red",c.style.color="white",f(`RX STARTED [${a?"AUDIBLE":"ULTRASONIC"}] - Awaiting preamble...`),document.querySelector(".placeholder-text").innerText="LISTENING ON MIC..."):(c.innerText="START LISTENING",c.style.background="",c.style.color="",f("RX STOPPED."),document.querySelector(".placeholder-text").innerText="WAITING FOR SIGNAL...")});A.addEventListener("change",e=>{const n=e.target.files[0];n&&f(`FILE SELECTED: ${n.name} (${n.size} bytes)`)});
